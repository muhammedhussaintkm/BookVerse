<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>File Details - BookVerse</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body {
      background: url('https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?fm=jpg&q=80&w=3000&ixlib=rb-4.0.3') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 20px;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .file-card {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      align-items: center;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
    }
    .file-card img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 5px;
    }
    .file-details {
      flex: 1;
    }
    .file-details h2 {
      margin: 0 0 10px;
      font-size: 28px;
    }
    .file-details p {
      margin: 5px 0;
      font-size: 16px;
    }
    .buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .buttons button {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    .back-btn {
      background-color: #1876db;
      color: white;
    }
    .download-btn {
      background-color: #28a745;
      color: white;
    }
    .description {
      font-size: 16px;
      line-height: 1.5;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="fileDetailsForm">
      <div class="file-card">
        <!-- Card left: sample cover image -->
        <img id="sampleCover" src="/sample_covers/default.jpg" alt="File Icon">
        <!-- Card right: file details -->
        <div class="file-details">
          <h2 id="fileName">File Name</h2>
          <p><strong>File Type:</strong> <span id="fileType"></span></p>
          <p><strong>Semester:</strong> <span id="semester"></span></p>
          <p><strong>Department:</strong> <span id="department"></span></p>
          <p><strong>Uploader:</strong> <span id="uploaderName"></span></p>
        </div>
      </div>
      <!-- File description -->
      <div class="description" id="description">Description goes here...</div>
      <!-- Buttons: Back and Download -->
      <div class="buttons">
        <button type="button" class="back-btn" onclick="goBack()">Back</button>
        <button type="button" class="download-btn" onclick="downloadFile()">Download</button>
      </div>
    </form>
  </div>

  <script>
    // Parse the query parameter to get the file id
    // 1) Grab both file id and email from the URL
  const urlParams = new URLSearchParams(window.location.search);
  const fileId = urlParams.get('id');
  const currentUserEmail = urlParams.get('email');

    // Fetch file details using the file id (using the correct endpoint)
    fetch(`/user/filedetails?id=${fileId}`)
      .then(response => response.json())
      .then(data => {
        if(data) {
          document.getElementById('fileName').textContent = data.file_name;
          // Extract file extension to determine file type and sample cover image
          const ext = data.file_name.split('.').pop().toLowerCase();
          document.getElementById('fileType').textContent = ext;
          document.getElementById('semester').textContent = data.semester || 'N/A';
          document.getElementById('department').textContent = data.department || 'N/A';
          document.getElementById('uploaderName').textContent = data.uploader_name || 'Unknown';
          document.getElementById('description').textContent = data.description || 'No description provided.';

          // Choose sample cover image based on file extension
          let sampleCover = 'file.png';
          switch(ext) {
            case 'pdf':
              sampleCover = 'pdf.png';
              break;
            case 'doc':
            case 'txt':
            case 'docx':
              sampleCover = 'txt.png';
              break;
            case 'ppt':
            case 'pptx':
              sampleCover = 'ppt.png';
              break;
            // Add more cases if needed
            default:
              sampleCover = 'file.png';
          }
          document.getElementById('sampleCover').src = sampleCover;
        }
      })
      .catch(err => console.error('Error fetching file details:', err));

    
  // 3) Back button: include email
  function goBack() {
    // adjust the target page as needed (e.g. dashboard, myFiles, etc.)
    window.location.href = `/dashboard?email=${encodeURIComponent(currentUserEmail)}`;
  }

    // Trigger file download via backend download endpoint
    function downloadFile(){
      window.location.href = `/user/download?id=${fileId}`;
    }
  </script>
</body>
</html>
